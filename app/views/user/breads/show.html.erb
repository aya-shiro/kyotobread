<div class="container mt-4">

  <div class="text-success">
    <%= flash[:notice] %>
  </div>

  <% if @user != current_user %>  <!--他ユーザの投稿詳細ページならユーザリンクを表示-->
    <div class="row mb-5">

      <div class="col-1">
        <%= link_to user_path(@user.id) do %>
          <%= image_tag @user.get_user_image(80, 80) %>
        <% end %>
      </div>
      <div class="col-4">
        <%= link_to user_path(@user.id) do %>
          <p><%= @user.name %></p>
        <% end %>
      </div>
    </div>
  <% end %>

  <div class="row">
    <div class="col-md-5">
      <%= image_tag @bread.get_bread_image(400, 400) %>
    </div>

    <div class="col-md-6">
      <h5><%= @bread.bread_name %></h5>
      <p><%= @bread.introduce %></p>

      <table>
        </tr>
          <td class="py-2">ジャンル</td>
          <td>
            <% if @bread.taste == "sweet" %>
              甘い系
            <% else %>
              塩味系
            <% end %>
          </td>
        </tr>
        </tr>
          <td class="py-2">一緒に飲むなら？</td>
          <td><%= @bread.drink.drink_name %></td>
        </tr>
        <tr>
          <td class="py-2">購入店名</td>
          <td><%= @bread.shop.address_display %></td>
        </tr>
        <tr>
          <td class="py-2">投稿日</td>
          <td><%= @bread.created_at.strftime("%Y/%m/%d") %></td>
        </tr>

        <% if @bread.created_at != @bread.updated_at %>    <!--投稿後に編集された場合のみaudated_atを表示したい-->
          <tr style="color: gray;">
            <td class="py-2">(最終更新</td>
            <td><%= @bread.updated_at.in_time_zone('Tokyo').strftime("%Y/%m/%d %H:%M") %>)</td>    <!--東京時間のhour/minutesまで表示-->
          </tr>
        <% end %>
      </table>

      <% if @bread.favorite_by?(current_user) %>
        <span class="mt-3">
          <%= link_to bread_favorites_path(@bread.id), method: :delete do %>
            <i class="fa-solid fa-heart" style="color: #e40101;"></i> <%= @bread.favorites.count %>
          <% end %>
        </span>
      <% else %>
        <span class="mt-3">
          <%= link_to bread_favorites_path(@bread.id), method: :post do %>
            <i class="fa-regular fa-heart" style="color: #e40101;"></i> <%= @bread.favorites.count %>
          <% end %>
        </span>
      <% end %>

      <span class="ml-3"><i class="far fa-comment-dots fa-flip-horizontal"></i> <%= @bread.comments.count %></span>


      <% if @bread.user == current_user %>
        <%= link_to "編集", edit_bread_path(@bread.id), class:"mt-3 ml-5 btn btn-outline-secondary" %>
        <%= link_to "削除", bread_path(@bread.id), method: :delete, "data-confirm" => "本当に削除しますか？", class:"mt-3 btn btn-outline-secondary" %>
      <% end %>
    </div>
  </div>


  <!--レイアウト調整する-->
  <div class="row">
    <div class="col-10 mt-3">
      <table>
        <% if @bread.comments.exists? %>
          <% @bread.comments.each do |comment| %>
            <tr>
              <td>
                <%= image_tag comment.user.get_user_image(50, 50) %>
                <%= comment.user.name %>
                <span style="font-size: 3px; color: gray;">
                  <%= comment.created_at.strftime("%Y/%m/%d") %>
                </span><br>
                <%= comment.comment %>
                <% if comment.user == current_user %>
                  <%= link_to "削除", bread_comment_path(comment.id), method: :delete, class:"btn btn-sm btn-secondary" %>
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <td>コメントを書く</td>
        <% end %>
        <tr>
        <%= form_with model:[@bread, @comment] do |f| %>
          <td><%= f.text_area :comment, placeholder:"コメントをどうぞ", rows: 1,cols: 70, class:"mt-3 form-control" %></td>
          <td><%= f.submit "送信する", class:"mt-2 btn btn-sm btn-secondary" %></td>
        <% end %>
        </tr>
      </table>
    </div>

  </div>


</div>